<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://d3js.org/d3.v5.js" charset="utf-8"></script>
    <script src="map.js" charset="utf-8"></script>
    <title>D3 Map Component</title>
    <style>
        path {
            /* color: black; */
            /* stroke: grey; */
            fill: none;
        }
        svg {
            background-color:none;
        }
        use.stitches {
            stroke: #F00;
            stroke-width: 3px;
            fill: none;
        }
        use.stitches2 {
            stroke: #0F0;
            stroke-width: 3px;
            fill: none;
        }
    </style>
</head>
<body>
    <h1>Nevada 2017 Tracts</h1>
    <svg id="svg-map" width="1201" height="1401"
            viewBox="-500 -500 2000 2000"
            >
        <defs>
            <g id="source">
                <title> Source </title>
                <desc> A glyph representing a source. </desc>
                <circle r="10"></circle>
            </g>
            <g id="sink">
                <title> Sink </title>
                <desc> A glyph representing a sink. </desc>
                <path d="M10,0 H-10 M0,10 V-10"></path>
            </g>
        </defs>
        <!-- modern browsers can use defs in external svg files; we might want to switch to this approach as we accumulate a design library of glyphs! -->

        <!-- Example use -->
        <!-- <use x="480" y="250" xlink:href="#sink" fill="none" stroke="#F00" stroke-width="3" /> -->
    </svg>
    <script>
        // select and size the SVG
        var svg = d3.select("svg#svg-map");
        var w = +svg.attr("width");
        var h = +svg.attr("height");
        var cities, sales, color, geo;
        let pins = [
            {x:-115, y:36, class:'stitches', glyph:'source'},
            {x:-115, y:37, class:'stitches', glyph:'sink'},
            {x:-116, y:36, class:'stitches2', glyph:'sink'},
            {x:-116, y:37, class:'stitches', glyph:'source'}
        ];

        let map = createMap(svg)
            .marks( pins )
            .click( function(mark, index, selection){
                console.log(mark);}
            );
            
        map();

        // let elevationScale = d3.scaleLinear()
        //     .range(['#222', '#ddd'])
        //     .domain([-100, 4400]);
        // map.setColorScale( elevationScale );

        // add the prepared 2017 tract data
        d3.json( 'tracts/nv.json' )
            .then( map.addBounds );

        // d3.json( 'elevation/N35W120H-100.json' )
        //     .then( map.addContour );
        map.addContour( {type:"Sphere", value:-100} );
        // meh, just set sea level on the entire sphere rather than rendering the complex geometry resulting from data missing in the SRTM patch!
        
        // add the contour data as it loads
        d3.json( 'elevation/N35W120H500.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H1000.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H1500.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H2000.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H2500.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H3000.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H3500.json' )
            .then( map.addContour );
        d3.json( 'elevation/N35W120H4000.json' )
            .then( map.addContour );
    </script>
  
</body>
</html>